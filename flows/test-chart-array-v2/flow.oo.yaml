title: "Test Chart Array Builder V2"
description: "Demonstration of the simplified Chart Array Builder V2 that accepts array input directly"

nodes:
  # Step 1: Load data
  - node_id: load#1
    task: self::data-loader
    inputs_from:
      - handle: source_type
        value: csv
      - handle: file_path
        value: /oomol-driver/oomol-storage/sample_sales.csv
      - handle: database_config
        value: null

  # Step 2: Transform data
  - node_id: transform#1
    task: self::nl-to-sql
    inputs_from:
      - handle: input_table
        from_node:
          - node_id: load#1
            output_handle: data_table
      - handle: instruction
        value: "Show top 10 regions by total sales"
      - handle: llm
        value:
          model: oomol-chat
          temperature: 0.5
          top_p: 1
          max_tokens: 128000

  # Step 3: Get chart recommendations
  - node_id: recommend#1
    task: self::chart-recommender
    inputs_from:
      - handle: data_table
        from_node:
          - node_id: transform#1
            output_handle: result_table
      - handle: analysis_goal
        value: "Compare regional sales performance"
      - handle: llm
        value:
          model: oomol-chat
          temperature: 0.5
          top_p: 1
          max_tokens: 128000

  # Step 4: Select first recommendation
  - node_id: select#1
    task: self::chart-selector
    inputs_from:
      - handle: recommendations
        from_node:
          - node_id: recommend#1
            output_handle: recommended_charts
      - handle: selection_index
        value: 0

  # Step 5: Generate first chart
  - node_id: chart1#1
    task: self::chart-generator
    inputs_from:
      - handle: data_table
        from_node:
          - node_id: transform#1
            output_handle: result_table
      - handle: chart_type
        from_node:
          - node_id: select#1
            output_handle: chart_type
      - handle: x_field
        from_node:
          - node_id: select#1
            output_handle: x_field
      - handle: y_field
        from_node:
          - node_id: select#1
            output_handle: y_field
      - handle: color_field
        from_node:
          - node_id: select#1
            output_handle: color_field
      - handle: size_field
        from_node:
          - node_id: select#1
            output_handle: size_field

  # Step 6: Use scriptlet to build chart array
  - node_id: +python#1
    title: "Build Chart Array"
    icon: ":logos:python:"
    task:
      inputs_def:
        - handle: chart1_image
          json_schema: {type: string}
          nullable: false
        - handle: chart1_title
          json_schema: {type: string}
          nullable: false
        - handle: explanation
          json_schema: {type: string}
          nullable: false
      outputs_def:
        - handle: charts_list
          json_schema:
            type: array
            items:
              type: object
          nullable: false
      executor:
        name: python
        options:
          entry: scriptlets/+scriptlet#1.py
    inputs_from:
      - handle: chart1_image
        from_node:
          - node_id: chart1#1
            output_handle: chart_image
      - handle: chart1_title
        value: "Top 10 Regions by Sales"
      - handle: explanation
        from_node:
          - node_id: transform#1
            output_handle: explanation

  # Step 7: Use new Chart Array Builder V2
  - node_id: array#1
    task: self::chart-array-builder-v2
    inputs_from:
      - handle: charts
        from_node:
          - node_id: +python#1
            output_handle: charts_list

  # Step 8: Generate report
  - node_id: report#1
    task: self::report-generator
    inputs_from:
      - handle: charts
        from_node:
          - node_id: array#1
            output_handle: charts_array
      - handle: analysis_goal
        value: "Regional sales performance analysis"
      - handle: llm
        value:
          model: oomol-chat
          temperature: 0.5
          top_p: 1
          max_tokens: 128000
